<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Poker Predictor Pro</title>
    <style>
        :root {
            --bg-color: #121212;
            --panel-color: #1e1e1e;
            --primary: #27ae60;
            --accent: #3498db;
            --text: #e0e0e0;
            --card-empty: #333;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text);
            margin: 0;
            padding: 10px;
            padding-bottom: 50px; 
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        h1 { margin: 15px 0; font-size: 1.4rem; text-align: center; color: #fff; }

        /* --- Card Slots UI --- */
        .section {
            background: var(--panel-color);
            padding: 15px;
            border-radius: 12px;
            width: 100%;
            max-width: 450px;
            margin-bottom: 15px;
            box-sizing: border-box;
            box-shadow: 0 4px 10px rgba(0,0,0,0.5);
        }

        .section-title {
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 12px;
            color: #888;
            font-weight: bold;
        }

        .card-row {
            display: flex;
            gap: 10px;
            justify-content: center;
        }

        .card-slot {
            width: 60px;
            height: 85px;
            background: var(--card-empty);
            border-radius: 6px;
            border: 2px dashed #555;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            position: relative;
            transition: transform 0.1s;
        }

        .card-slot:active { transform: scale(0.95); }

        /* Filled Card Styling */
        .card-slot.filled {
            background: white;
            border: 2px solid #ccc;
        }
        .card-slot.filled span.rank {
            font-size: 1.8rem;
            font-weight: bold;
            line-height: 1;
        }
        .card-slot.filled span.suit {
            font-size: 2rem;
            line-height: 1;
            margin-top: -5px;
        }
        
        /* Suit Colors */
        .suit-h, .suit-d { color: #c0392b; } /* Red */
        .suit-s, .suit-c { color: #2c3e50; } /* Black */
        
        /* Empty State Text */
        .card-slot .placeholder {
            font-size: 2rem;
            color: #555;
        }

        /* --- Controls --- */
        .slider-wrapper {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: #2a2a2a;
            padding: 10px;
            border-radius: 8px;
        }
        input[type=range] { flex: 1; margin: 0 15px; }

        button.action-btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 16px;
            border-radius: 50px;
            font-size: 1.2rem;
            width: 100%;
            max-width: 450px;
            font-weight: bold;
            box-shadow: 0 4px 15px rgba(39, 174, 96, 0.4);
            cursor: pointer;
            margin-top: 10px;
        }
        button.action-btn:active { transform: scale(0.98); }
        button:disabled { background: #555; opacity: 0.7; }

        /* --- Results Area --- */
        #results-area { display: none; width: 100%; max-width: 450px; }
        .stat-card {
            background: var(--panel-color);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            margin-bottom: 15px;
        }
        .big-percent { font-size: 3rem; font-weight: 800; color: var(--primary); }
        .advice-badge {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: bold;
            margin-top: 10px;
            font-size: 1rem;
        }
        .advice-badge.raise { background: rgba(46, 204, 113, 0.2); color: #2ecc71; border: 1px solid #2ecc71; }
        .advice-badge.call { background: rgba(241, 196, 15, 0.2); color: #f1c40f; border: 1px solid #f1c40f; }
        .advice-badge.fold { background: rgba(231, 76, 60, 0.2); color: #e74c3c; border: 1px solid #e74c3c; }

        .prob-row {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #333;
            font-size: 0.95rem;
        }

        /* --- MODAL PICKER --- */
        #picker-modal {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        .picker-content {
            background: #252525;
            padding: 20px;
            border-radius: 15px;
            width: 90%;
            max-width: 350px;
            text-align: center;
        }
        .picker-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            border-bottom: 1px solid #444;
            padding-bottom: 10px;
        }
        .close-btn { background: none; border: none; color: #777; font-size: 1.5rem; cursor: pointer; }

        /* Step 1: Suits */
        .suit-selector {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
        }
        .suit-btn {
            width: 60px;
            height: 60px;
            border-radius: 10px;
            background: #333;
            border: 2px solid transparent;
            font-size: 2rem;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }
        .suit-btn.selected { border-color: var(--accent); background: #444; }

        /* Step 2: Ranks */
        .rank-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
        }
        .rank-btn {
            background: #333;
            color: #fff;
            padding: 10px 0;
            border-radius: 5px;
            border: none;
            font-size: 1.1rem;
            font-weight: bold;
        }
        .rank-btn:disabled { opacity: 0.3; } /* If no suit selected */
        .rank-btn:active { background: var(--accent); }

    </style>
</head>
<body>

    <h1>SCS Poker Solver ‚ô†Ô∏è‚ô•Ô∏è</h1>

    <div class="section">
        <div class="section-title">My Hand</div>
        <div class="card-row">
            <div class="card-slot" id="hero1" onclick="openPicker('hero1')" data-val="">
                <span class="placeholder">+</span>
            </div>
            <div class="card-slot" id="hero2" onclick="openPicker('hero2')" data-val="">
                <span class="placeholder">+</span>
            </div>
        </div>
    </div>

    <div class="section">
        <div class="section-title">Total Players: <span id="p-count-display">2</span></div>
        <div class="slider-wrapper">
            <span style="color:#777">2</span>
            <input type="range" id="player-count" min="2" max="9" value="2">
            <span style="color:#777">9</span>
        </div>
    </div>

    <div class="section">
        <div class="section-title">Community Cards</div>
        <div class="card-row" style="margin-bottom:10px;">
            <div class="card-slot" id="board1" onclick="openPicker('board1')" style="width:50px; height:70px" data-val=""><span class="placeholder">+</span></div>
            <div class="card-slot" id="board2" onclick="openPicker('board2')" style="width:50px; height:70px" data-val=""><span class="placeholder">+</span></div>
            <div class="card-slot" id="board3" onclick="openPicker('board3')" style="width:50px; height:70px" data-val=""><span class="placeholder">+</span></div>
        </div>
        <div class="card-row">
            <div class="card-slot" id="board4" onclick="openPicker('board4')" style="width:50px; height:70px" data-val=""><span class="placeholder">+</span></div>
            <div class="card-slot" id="board5" onclick="openPicker('board5')" style="width:50px; height:70px" data-val=""><span class="placeholder">+</span></div>
        </div>
    </div>

    <button class="action-btn" onclick="calculateOdds()">CALCULATE WIN %</button>
    
    <div style="height:20px"></div>

    <div id="results-area">
        <div class="stat-card">
            <div style="color:#aaa; font-size:0.9rem">Win Probability</div>
            <div class="big-percent" id="win-percent">--%</div>
            <div class="advice-badge" id="advice-badge">--</div>
        </div>
        
        <div class="section">
            <div class="section-title">Hand Possibilities</div>
            <div id="hand-breakdown"></div>
        </div>
        
        <button onclick="resetGame()" style="background:#c0392b; margin-top:10px; padding:10px; width:100%; border:none; border-radius:8px; color:white;">Reset All</button>
    </div>

    <div id="picker-modal">
        <div class="picker-content">
            <div class="picker-header">
                <span style="font-weight:bold; color:#fff;">Select Card</span>
                <button class="close-btn" onclick="closePicker()">√ó</button>
            </div>
            
            <button onclick="clearCurrentCard()" style="width:100%; margin-bottom:15px; padding:8px; background:#444; color:#fff; border:none; border-radius:5px;">Clear Card</button>

            <div class="suit-selector">
                <div class="suit-btn" onclick="selectSuit('s')" id="btn-s" style="color:#aab7b8">‚ô†</div>
                <div class="suit-btn" onclick="selectSuit('h')" id="btn-h" style="color:#e74c3c">‚ô•</div>
                <div class="suit-btn" onclick="selectSuit('c')" id="btn-c" style="color:#aab7b8">‚ô£</div>
                <div class="suit-btn" onclick="selectSuit('d')" id="btn-d" style="color:#e74c3c">‚ô¶</div>
            </div>

            <div class="rank-grid" id="rank-container">
                </div>
        </div>
    </div>

<script>
    // --- STATE ---
    let currentSlotId = null;
    let tempSuit = null; // 's', 'h', 'd', 'c'

    const SUITS = ['s', 'h', 'd', 'c'];
    const RANKS = ['A','K','Q','J','T','9','8','7','6','5','4','3','2']; // T = 10
    const SUIT_ICONS = {'s':'‚ô†', 'h':'‚ô•', 'd':'‚ô¶', 'c':'‚ô£'};

    // --- UI LOGIC ---

    // Generate Rank Buttons
    const rankContainer = document.getElementById('rank-container');
    RANKS.forEach(r => {
        const btn = document.createElement('button');
        btn.className = 'rank-btn';
        btn.innerText = r === 'T' ? '10' : r;
        btn.onclick = () => selectRank(r);
        rankContainer.appendChild(btn);
    });

    // Player slider listener
    document.getElementById('player-count').addEventListener('input', (e) => {
        document.getElementById('p-count-display').innerText = e.target.value;
    });

    function openPicker(id) {
        currentSlotId = id;
        tempSuit = null; // Reset selection
        
        // Reset UI Styles
        document.querySelectorAll('.suit-btn').forEach(b => b.classList.remove('selected'));
        // Disable ranks until suit picked
        document.querySelectorAll('.rank-btn').forEach(b => {
            b.disabled = true;
            b.style.color = '#fff'; 
        });

        document.getElementById('picker-modal').style.display = 'flex';
    }

    function closePicker() {
        document.getElementById('picker-modal').style.display = 'none';
    }

    function selectSuit(s) {
        tempSuit = s;
        // Highlight selection
        document.querySelectorAll('.suit-btn').forEach(b => b.classList.remove('selected'));
        document.getElementById('btn-'+s).classList.add('selected');
        
        // Enable ranks and color them
        const color = (s === 'h' || s === 'd') ? '#e74c3c' : '#aab7b8';
        document.querySelectorAll('.rank-btn').forEach(b => {
            b.disabled = false;
            b.style.color = color;
        });
    }

    function selectRank(r) {
        if (!tempSuit) return;
        
        const fullVal = r + tempSuit; // e.g., "Ah"
        updateCardSlot(currentSlotId, fullVal);
        closePicker();
    }

    function clearCurrentCard() {
        updateCardSlot(currentSlotId, "");
        closePicker();
    }

    function updateCardSlot(id, val) {
        const el = document.getElementById(id);
        el.dataset.val = val;
        
        if (val === "") {
            el.className = "card-slot";
            el.innerHTML = '<span class="placeholder">+</span>';
            return;
        }

        const r = val.slice(0, -1);
        const s = val.slice(-1);
        const rDisplay = r === 'T' ? '10' : r;
        const suitClass = 'suit-' + s;

        el.className = `card-slot filled ${suitClass}`;
        el.innerHTML = `
            <span class="rank">${rDisplay}</span>
            <span class="suit">${SUIT_ICONS[s]}</span>
        `;
    }
    
    function resetGame() {
        ['hero1','hero2','board1','board2','board3','board4','board5'].forEach(id => {
            updateCardSlot(id, "");
        });
        document.getElementById('results-area').style.display = 'none';
    }

    // --- POKER ENGINE (Monte Carlo) ---
    // (Same logic as before, adapted for data-val attributes)

    const RANKS_ORDER = ['2','3','4','5','6','7','8','9','T','J','Q','K','A'];

    function parseCard(str) {
        if (!str) return null;
        const rChar = str.slice(0, -1);
        const sChar = str.slice(-1);
        const rank = RANKS_ORDER.indexOf(rChar);
        const suit = SUITS.indexOf(sChar);
        return { rank, suit, str }; 
    }

    function calculateOdds() {
        const btn = document.querySelector('.action-btn');
        const oldText = btn.innerText;
        btn.innerText = "Running Sim...";
        btn.disabled = true;

        setTimeout(() => {
            runSimulation();
            btn.innerText = oldText;
            btn.disabled = false;
        }, 50);
    }

    function evaluateHand(cards) {
        cards.sort((a, b) => b.rank - a.rank);
        const ranks = cards.map(c => c.rank);
        const counts = {};
        ranks.forEach(r => counts[r] = (counts[r] || 0) + 1);
        
        const isFlush = Object.values(cards.reduce((acc, c) => {
            acc[c.suit] = (acc[c.suit] || 0) + 1; return acc;
        }, {})).some(count => count >= 5);

        let uniqueRanks = [...new Set(ranks)];
        if (uniqueRanks.includes(12)) uniqueRanks.push(-1); // Ace low support

        let straightHigh = -1;
        for (let i = 0; i <= uniqueRanks.length - 5; i++) {
            if (uniqueRanks[i] - uniqueRanks[i+4] === 4) {
                straightHigh = uniqueRanks[i];
                break;
            }
        }
        
        // Quick check for Straight Flush
        if (isFlush && straightHigh !== -1) {
             // simplified strict check
             const flushSuit = Object.keys(cards.reduce((acc,c)=>{acc[c.suit]=(acc[c.suit]||0)+1; return acc;},{}))
                .find(s => cards.filter(c => c.suit == s).length >= 5);
             const fCards = cards.filter(c => c.suit == flushSuit);
             let fRanks = [...new Set(fCards.map(c=>c.rank))].sort((a,b)=>b-a);
             if(fRanks.includes(12)) fRanks.push(-1);
             for(let i=0; i<=fRanks.length-5; i++){
                 if(fRanks[i] - fRanks[i+4] === 4) return [8, fRanks[i]];
             }
        }

        const countValues = Object.values(counts);
        const countKeys = Object.keys(counts).map(Number).sort((a,b)=>counts[b]-counts[a] || b-a);

        if (countValues.includes(4)) return [7, countKeys[0], countKeys[1]];
        if (countValues.includes(3) && countValues.includes(2)) return [6, countKeys[0], countKeys[1]];
        if (isFlush) return [5, ...ranks.slice(0,5)];
        if (straightHigh !== -1) return [4, straightHigh];
        if (countValues.includes(3)) return [3, countKeys[0], countKeys[1], countKeys[2]];
        if (countValues.filter(x => x === 2).length >= 2) return [2, countKeys[0], countKeys[1], countKeys[2]];
        if (countValues.includes(2)) return [1, countKeys[0], ...countKeys.slice(1,4)];
        
        return [0, ...ranks.slice(0,5)];
    }

    function compareScores(scoreA, scoreB) {
        for (let i = 0; i < Math.max(scoreA.length, scoreB.length); i++) {
            if ((scoreA[i]||0) > (scoreB[i]||0)) return 1;
            if ((scoreA[i]||0) < (scoreB[i]||0)) return -1;
        }
        return 0;
    }

    function runSimulation() {
        const getVal = (id) => document.getElementById(id).dataset.val;
        
        const hero1Val = getVal('hero1');
        const hero2Val = getVal('hero2');
        const boardVals = [
            getVal('board1'), getVal('board2'), getVal('board3'), 
            getVal('board4'), getVal('board5')
        ].filter(v => v);

        if (!hero1Val || !hero2Val) {
            alert("Set your 2 cards first!");
            return;
        }

        const heroCards = [parseCard(hero1Val), parseCard(hero2Val)];
        const currentBoard = boardVals.map(parseCard);
        
        // Validation
        const allStrs = [...heroCards, ...currentBoard].map(c=>c.str);
        if (new Set(allStrs).size !== allStrs.length) {
            alert("Duplicate cards detected!");
            return;
        }

        const numPlayers = parseInt(document.getElementById('player-count').value);
        const simulations = 2500; 
        let wins = 0;
        let ties = 0;
        const handCounts = Array(9).fill(0);

        // Deck
        const fullDeck = [];
        SUITS.forEach(s => RANKS_ORDER.forEach(r => fullDeck.push(r+s)));
        const remainingDeck = fullDeck.filter(c => !allStrs.includes(c));

        for (let i = 0; i < simulations; i++) {
            let simDeck = [...remainingDeck];
            // Fisher-Yates shuffle (partial)
            for (let j = simDeck.length - 1; j > 0; j--) {
                const k = Math.floor(Math.random() * (j + 1));
                [simDeck[j], simDeck[k]] = [simDeck[k], simDeck[j]];
            }

            let deckIdx = 0;
            // Fill board
            const neededBoard = 5 - currentBoard.length;
            const simBoard = [...currentBoard, ...simDeck.slice(0, neededBoard).map(parseCard)];
            deckIdx += neededBoard;

            // Opponents
            const opponents = [];
            for (let p = 0; p < numPlayers - 1; p++) {
                opponents.push([parseCard(simDeck[deckIdx++]), parseCard(simDeck[deckIdx++])]);
            }

            // Eval
            const heroScore = evaluateHand([...heroCards, ...simBoard]);
            handCounts[heroScore[0]]++;

            let heroWins = true; 
            let isTie = false;

            for (let opp of opponents) {
                const res = compareScores(heroScore, evaluateHand([...opp, ...simBoard]));
                if (res < 0) { heroWins = false; break; }
                if (res === 0) isTie = true;
            }

            if (heroWins) {
                if (isTie) ties++;
                else wins++;
            }
        }

        const winRate = ((wins + (ties/2)) / simulations) * 100;
        displayResults(winRate, handCounts, simulations, numPlayers);
    }

    const HAND_NAMES = ["High Card", "Pair", "Two Pair", "3 of a Kind", "Straight", "Flush", "Full House", "4 of a Kind", "Straight Flush"];

    function displayResults(winRate, handCounts, totalSims, players) {
        document.getElementById('results-area').style.display = 'block';
        
        document.getElementById('win-percent').innerText = Math.round(winRate) + "%";
        
        const badge = document.getElementById('advice-badge');
        const fair = 100 / players;
        
        if (winRate > fair * 1.5) {
            badge.innerText = "RAISE üöÄ"; badge.className = "advice-badge raise";
        } else if (winRate > fair * 0.85) {
            badge.innerText = "CALL / CHECK ‚úÖ"; badge.className = "advice-badge call";
        } else {
            badge.innerText = "FOLD ‚ùå"; badge.className = "advice-badge fold";
        }

        let html = "";
        for (let i = 8; i >= 1; i--) {
            const pct = (handCounts[i] / totalSims) * 100;
            if (pct >= 1) {
                html += `
                <div class="prob-row">
                    <span>${HAND_NAMES[i]}</span>
                    <span style="color:var(--primary); font-weight:bold">${pct.toFixed(0)}%</span>
                </div>`;
            }
        }
        document.getElementById('hand-breakdown').innerHTML = html || "<div style='text-align:center; color:#555'>Mostly High Card</div>";
        
        window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
    }
</script>

</body>
</html>
